/*!
 * bootstrap-imgupload v2.1.0 2016/05/22
 * https://github.com/egonolieux/bootstrap-imgupload
 * Copyright 2016 Egon Olieux
 * Released under the MIT license
 */
!function(e){function n(e){var n=[];return n.push("<div class='alert alert-danger alert-dismissible'>"),n.push("<button type='button' class='close' data-dismiss='alert'>"),n.push("<span>&times;</span>"),n.push("</button>"+e),n.push("</div>"),n.join("")}function i(e){return"<img src='"+e+"' alt='Image preview' style='max-width: "+f.previewWidth+"px; max-height: "+f.previewHeight+"px'>"}function t(n,i){var t=new Image;t.onerror=function(){i(!1,"Image could not be found.")},t.onload=function(){var t=n.substr(n.lastIndexOf(".")+1).toLowerCase();e.inArray(t,f.allowedFormats)>-1?i(!0,"Image is valid."):i(!1,"Image format is not allowed.")},t.src=n}function a(e){var n=e.closest(".imgupload"),i=n.find(".panel-heading .btn:eq(0)");if(!i.hasClass("active")){var t=n.find(".url-tab");n.find(".panel-heading .btn:eq(1)").removeClass("active"),i.addClass("active"),t.hide(),e.show(),l(t)}}function o(e){e.find(".alert").remove(),e.find(".btn:eq(1)").hide(),e.find(".btn span").text("Browse"),e.find("input").val(""),e.find("img").remove()}function d(t){var a=t.find(".btn:eq(0)"),o=a.find("input");t.find(".alert").remove(),t.find("img").remove();var d=o[0].files&&o[0].files[0];if(d){var r=o[0].files[0];if(r.size/1024>f.maxFileSizeKb)return o.val(""),void t.append(n("File size is too large (max "+f.maxFileSizeKb+"kB)."));var l=r.name.substr(r.name.lastIndexOf(".")+1).toLowerCase();if(e.inArray(l,f.allowedFormats)>-1){var s=new FileReader;s.onload=function(e){t.append(i(e.target.result))},s.onerror=function(e){o.val(""),t.append(n("Error loading image."))},s.readAsDataURL(r),a.find("span").text("Change"),t.find(".btn:eq(1)").css("display","inline-block")}else o.val(""),t.append(n("Image format is not allowed."))}}function r(e){var n=e.closest(".imgupload"),i=n.find(".panel-heading .btn:eq(1)");if(!i.hasClass("active")){var t=n.find(".file-tab");n.find(".panel-heading .btn:eq(0)").removeClass("active"),i.addClass("active"),t.hide(),e.show(),o(t)}}function l(n){n.find(".alert").remove(),n.find("input").val(""),e.each(n.find(".btn"),function(n,i){"Remove"==e(i).text()?e(i).remove():e(i).text("Submit")}),n.find("img").remove()}function s(a){var o=a.find("input:text"),d=a.find(".btn"),r=a.find("input:text").val();o.prop("disabled",!0),d.prop("disabled",!0),a.find(".alert").remove(),a.find("img").remove(),t(r,function(t,l){t?(a.find("input:hidden").val(r),a.append(i(r)),1==d.length&&(a.find(".input-group-btn").append("<button type='button' class='btn btn-default'>Remove</button>"),a.find(".btn:eq(1)").on("click",function(){e(this).blur(),a.find(".alert").remove(),a.find("input").val(""),a.find("img").remove(),e(this).remove()}))):(2==d.length&&d[1].remove(),a.append(n(l))),o.prop("disabled",!1),d.prop("disabled",!1)})}var f={allowedFormats:["jpg","jpeg","png","gif"],previewWidth:250,previewHeight:250,maxFileSizeKb:2048};e.fn.imgupload=function(n){if(this.filter("div").hasClass("imgupload")){f=e.extend(f,n);var i=this.find(".file-tab"),t=this.find(".url-tab"),l=this.find(".panel-heading .btn:eq(0)"),u=i.find(".btn:eq(1)"),p=this.find(".panel-heading .btn:eq(1)"),v=t.find(".btn:eq(0)");o(i),a(i),l.off(),i.off("change",".btn:eq(0)"),u.off(),p.off(),v.off(),l.on("click",function(){e(this).blur(),a(i)}),i.on("change",".btn:eq(0)",function(){e(this).blur(),d(i)}),u.on("click",function(){e(this).blur(),o(i)}),p.on("click",function(){e(this).blur(),r(t)}),t.find(".btn:eq(0)").on("click",function(){e(this).blur(),s(t)})}return this}}(jQuery);